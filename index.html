<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<body>
  My Address
  <input type="text" id="myAddr" name="myAddr">
  <br /><br /><br />
  ----- Send Trx -----<br />
  Send address
  <input type="text" id="sendAddr" name="sendAddr"><br />
  Send amount
  <input type="text" id="sendAmount" name="sendAmount"><br />
  <button onclick="sendTrx()">Send</button>
  <br /><br /><br />
  <script>
    async function sendTrx() {
      console.log("sendTrx");

      if (window.tronWeb && window.tronWeb.defaultAddress.base58) {
        console.log("sendTrx1");

        var myAddr = document.getElementById("myAddr").value;
        var sendAddr = document.getElementById("sendAddr").value;
        var sendAmount = parseInt(document.getElementById("sendAmount").value);

        if (sendAmount == null || sendAmount <= 0) {
          alert("송금할 적절한 금액을 입력하세요");
          return;
        }

        try {
          var tronweb = window.tronWeb;
		  var hexMyAddr = tronWeb.toHex(myAddr);
		  var hexSendAddr = tronWeb.toHex(sendAddr);
		  console.log("hexMyAddr : " + hexMyAddr);
		  console.log("hexSendAddr : " + hexSendAddr);
          var tx = await tronweb.transactionBuilder.sendTrx(hexSendAddr, sendAmount, hexMyAddr)
          var signedTx = await tronweb.trx.sign(tx)
          var broastTx = await tronweb.trx.sendRawTransaction(signedTx)
          console.log(broastTx)
          alert("송금완료!");
        }
        catch (err) {
          alert("송금 에러! " + err);
        }
      }
    }

    window.addEventListener('message', function (e) {
      if (e.data.message) {
        if (e.data.message.action == "tabReply") {
          console.log("tabReply event", e.data.message)
          if (e.data.message.data.data.node.chain == '_') {
            console.log("tronLink currently selects the main chain")
          } else {
            console.log("tronLink currently selects the side chain")
          }
        }
        else if (e.data.message.action == "setAccount") {
          console.log("setAccount event", e.data.message)
          console.log("current address:", e.data.message.data.address)
        }
        else if (e.data.message.action == "setNode") {
          console.log("setNode event", e.data.message)
          if (e.data.message.data.node.chain == '_') {
            console.log("tronLink currently selects the main chain")
          } else {
            console.log("tronLink currently selects the side chain")
          }
        }
        else {
          console.log("other message : " + e.data.message.action);
        }
      }
    })
  </script>
</body>
</html>